<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="Vue" name="keywords">
    <meta content="数据分页在项目中的使用频率是非常高的,但是对于新手来说是一个难点和痛点,这里我记录一次数据分页从环境搭建到最后页面的渲染的过程,对于新手可以用来参考。" name="description">
    <meta content="J.sky" name="author">
    <link rel="icon" type="image/png" href="https://suiyan.cc/assets/images/favicon/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="https://suiyan.cc/assets/images/favicon/favicon-16x16.png" sizes="16x16" />
    <title>SuiYan-碎言博客vue3前端打包集成到后端fastAPI的uvicorn服务器</title>
    <!-- 引入 pico.css -->
    <link rel="stylesheet" href="https://suiyan.cc/assets/css/pico.min.css">
    <!-- 引入 图标CDN -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 引入 站点样式 -->
    <link rel="stylesheet" href="https://suiyan.cc/assets/css/custom.css">
    <script src="https://suiyan.cc/assets/js/jquery-3.3.1.min.js"></script>
</head>
<body>
<div class="hero" data-theme="dark" style="background-image: url('https://suiyan.cc/assets/images/bg.jpg');">
    <nav class="container-fluid"><ul>
    <li><a href="https://suiyan.cc/" class="contrast">SuiYan</a></li>
</ul>
<ul>
    <li>
        <details role="list" dir="rtl">
            <summary aria-haspopup="listbox" role="link" class="contrast">Theme</summary>
            <ul role="listbox">
                <li><a href="#" data-theme-switcher="auto">Auto</a></li>
                <li><a href="#" data-theme-switcher="light">Light</a></li>
                <li><a href="#" data-theme-switcher="dark">Dark</a></li>
            </ul>
        </details>
    </li>
</ul></nav>
    <head><header class="container">
    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
    <div class="hd"><span id="typed"></span></div>
    <script>
        const typed = new Typed('#typed', {
          strings: [
          
          'Life is short, you need Python',
          
          '人生苦短，我用Python.',
          
          'Beautiful is better than ugly.',
          
          '美丽优于丑陋.',
          
          'Explicit is better than implicit.',
          
          '直白优于含蓄.',
          
          'Simple is better than complex.',
          
          '简单优于复杂.',
          
          'Complex is better than complicated.',
          
          '复杂优于繁琐.',
          
          'Readability counts.',
          
          '可读性很重要.',
          
          ],
          typeSpeed: 100,
          backSpeed: 10,
          backDelay: 100,
          startDelay: 1000,
          loop:true
    });

    </script>
</header></head>
</div>
<main class="container">
    <div class="grid">
        <section>



<hgroup>
    <h1>vue3前端打包集成到后端fastAPI的uvicorn服务器</h1>
    <h3> 作者:<a href="#">你的大名</a> | <small>发表于:2023-04-23 09:43:05</small> | <small>更新于:2023-04-23 09:52:40</small> | Tag:
        
        
        <small>Vue</small>
        
    </h3>
</hgroup>
<p><p>数据分页在项目中的使用频率是非常高的,但是对于新手来说是一个难点和痛点,这里我记录一次数据分页从环境搭建到最后页面的渲染的过程,对于新手可以用来参考,大佬勿喷高抬贵手.</p>
<p>最终效果：</p>
<p><img alt="在这里插入图片描述" src="https://suiyan.cc/assets/images/2023/0423-01.png" /></p>
<h2>环境搭建</h2>
<p><img alt="在这里插入图片描述" src="https://suiyan.cc/assets/images/2023/0423-02.png" />
<code>fastapi-backend</code> 后端目录
<code>vue-frontend</code> 前端目录
这里我只贴一些关键的代码了,文末有代码仓库可以查看完整的代码.</p>
<h3>后端</h3>
<p>后端采用了<code>fastapi</code>框架,首先安装相关依赖<code>fastapi faker uvicorn</code>等,具体依赖可以参考文件头部的引用.后端的搭建首先是创建<code>fastapi</code>的实例,和解决跨域的问题,这些很简单,官方就有现成的代码,复制过来修改,然后就是在<code>models.py</code>中定义数据的模型,本项目中只有一个表和简单的字段:</p>
<p><code>python
from database import Base
from sqlalchemy import String,Column,Integer
class Item(Base):
    __tablename__ = 'item'
    id = Column(Integer,primary_key=True,autoincrement=True)
    addr = Column(String(256), nullable=False,index=True)</code>
然后在main.py的入口处创建数据库,并添加一些假数据.</p>
<p>```python
Base.metadata.create_all(engine) # create all tables</p>
<h1>创建测试数据</h1>
<p>item_count = 999
fk = Faker(locale="zh-CN")
db = get_db()
k = get_item_count(db)
if (get_item_count(db)==0):
    for i in range(item_count):
        addr = fk.address()
        item = Item(addr=addr)
        create_item(db,item)
```</p>
<p>第一行是创建数据库,后边判断表中是否有数据,没有的话创建999条虚拟数据.</p>
<p><code>crud.py</code>中定义了添加和查询的方法.</p>
<p>```python
from sqlalchemy.orm import Session
from models import Item
def create_item(db: Session, item: Item):
    db_item = Item(addr=item.addr)
    db.add(db_item)
    db.commit()
    db.refresh(db_item)
def get_item_count(db: Session):
    return db.query(Item).count()</p>
<h1>offset: 表示要跳过多少条数据,limit: 表示取几条数据,</h1>
<p>def get_items(db: Session,skip: int = 0, limit: int = 10):
    return db.query(Item).offset(skip).limit(limit).all()
```
分页数据后端的重点就在查询语句那里:<strong>offset: 表示要跳过多少条数据,limit: 表示取几条数据,</strong>根据前端返回的参数就可以查到需要的数据了.</p>
<p>然后就是创建<code>fastapi</code>的接口函数,<code>main.py</code>:</p>
<p><code>python
@app.get("/getitems")
def get_item_list(skip: int = 0, limit: int = 10,db:Session = Depends(get_db)):
    # print(skip,limit)
    data = dict()
    data["items"] = get_items(db=db,skip=skip,limit=limit)
    data["item_count"] = get_item_count(db)
    return data</code>
至此,后端的搭建基本完成,运行<code>main.py</code>后,打开<code>http://127.0.0.1:8000/docs</code>,就可以调试接口获取数据了:
<img alt="在这里插入图片描述" src="https://suiyan.cc/assets/images/2023/0423-03.png" />
如果能正常的获取数据,后端的搭建至此就结束了.</p>
<h2>前端搭建</h2>
<p>在项目的根目录终端下:</p>
<p><code>npm init vue@latest  # 然后一路回车即可</code>
起好前端项目的名字:<code>vue-frontend</code>,当然别的也可以.</p>
<p>安装 ant design for vue3
<code>npm i --save ant-design-vue</code>
安装后 配置前端下边的<code>main.js</code>引入ui框架.
```javascript
import { createApp } from 'vue'
import Antd from 'ant-design-vue';
import App from './App.vue'
import 'ant-design-vue/dist/antd.css';</p>
<p>const app = createApp(App);
app.use(Antd);
app.mount('#app');
<code>``
再安装</code>axios<code></code>npm install axios`</p>
<p>然后在前端目录的终端下:<code>npm run dev</code> 
即可看到项目正常启动了.</p>
<h2>前端数据的渲染</h2>
<p>首先搭建前端的界面,这里用到了<code>ant</code>的<code>list</code>和<code>pagination</code>,在 <code>home.vue</code>:</p>
<p><code>javascript
&lt;template lang=""&gt;
  &lt;a-list bordered :data-source="items"&gt;
    &lt;template #renderItem="{ item }"&gt;
      &lt;a-list-item&gt;{{ item.id }}.{{ item.addr }}&lt;/a-list-item&gt;
    &lt;/template&gt;
    &lt;template #header&gt;
      &lt;div&gt;列表展示&lt;/div&gt;
    &lt;/template&gt;
    &lt;template #footer&gt;
      &lt;div&gt;&lt;a-pagination @change="showSizeChange" v-model:current="current" :total="count" /&gt;&lt;/div&gt;
    &lt;/template&gt;
  &lt;/a-list&gt;
&lt;/template&gt;</code>
接下来就是定义<code>ref</code>和<code>ajax</code>的方法了:</p>
<p>```javascript</p>
<script setup>
import {ref} from 'vue'
import axios from 'axios'

const baseURL = 'http://localhost:8000'

const items = ref([])
const count = ref(0)
const current = ref(1)

axios.get(baseURL+'/getitems').then(function(response) {
    console.log(response.data)
    items.value = response.data.items
    count.value = response.data.item_count
})

const showSizeChange = (current,size) =>{
    console.log(current,size)
    let skip=size*(current-1)
    let limit=size
    axios.get(baseURL+'/getitems',
    {
        params:{
            skip: skip,
            limit: limit
        },
    },
    ).then(function(response) {
    console.log(response.data)
    items.value = response.data.items
    count.value = response.data.item_count
})
}
</script>
<p><code>``
前端的代码很简答的,vue3极大的简化了代码,还有就是翻页的pagination封装了大量分页的逻辑控制,我们只要通过两个数据就可以控制这个前端的翻页组件,</code>let skip=size*(current-1)`,这个是比较关键的代码,控制着数据返回的起始点.如果没有什么问题项目已经可以正常翻页了.</p>
<p>本文代码仓库:
<a href="https://github.com/bosichong/vue3-fastapi-pagination.git">https://github.com/bosichong/vue3-fastapi-pagination.git</a></p></p>


</section>
        <aside><section>
    <hgroup class="hd">
        <img class="avatar" src="https://suiyan.cc/assets/images/avatar.jpg"/>
        <h3>J.sky</h3>
        <div><small>不要害怕犯错，犯错也是学习过程中的一环。知识的价值，是不能用金钱简单衡量的。—— 原神:提纳里</small></div>
        <div class="blog-state">
            <div class="state-item">
                <small>115</small>
                <small>日志</small>
            </div>
            <div class="state-item">
                <small>21</small>
                <small>标签</small>
            </div>
        </div>
        <ul class="sns-ul">
            
            <li class="sns-li">
                <a href="https://github.com/bosichong/suiyan" target="_blank">
                    <i class="fa fa-github "></i>
                </a>
            </li>
            
            <li class="sns-li">
                <a href="https://gitee.com/J_Sky/suiyan" target="_blank">
                    <i class="fa fa-git "></i>
                </a>
            </li>
            
            <li class="sns-li">
                <a href="https://user.qzone.qq.com/285911/" target="_blank">
                    <i class="fa fa-qq "></i>
                </a>
            </li>
            
            <li class="sns-li">
                <a href="https://www.zhihu.com/people/J_sky/activities" target="_blank">
                    <i class="fa fa-book "></i>
                </a>
            </li>
            
            <li class="sns-li">
                <a href="https://suiyan.cc/rss.xml" target="_blank">
                    <i class="fa fa-rss "></i>
                </a>
            </li>
            
        </ul>
    </hgroup>

    <!-- Search -->
    <div id="blog-search">
        <input type="text" id="search-input" name="search" placeholder="JavaScript">
        <button id="search-btn" class="contrast"
                data-target="modal-example"
                onClick="toggleModal(event)">Search
        </button>

    </div>


    <!-- Modal -->
    <dialog id="modal-example">
        <article>
            <a href="#close"
               aria-label="Close"
               class="close"
               data-target="modal-example"
               onClick="toggleModal(event)">
            </a>
            <h3>搜索结果</h3>
            <div id="modal" style="display: none;">
                <ul id="result-list"></ul>
            </div>
        </article>
    </dialog>
    <script src="https://suiyan.cc/assets/js/url.js"></script>
    <script src="https://suiyan.cc/assets/js/main.js"></script>
    <script src="https://suiyan.cc/assets/js/modal.js"></script>

</section>


<nav>
    <ul id="blog-nav">
        
        <li>
            <a href="https://suiyan.cc/index.html">
                <i class="fa fa-home"></i>
                Home
            </a>
        </li>
        
        <li>
            <a href="https://suiyan.cc/archives.html">
                <i class="fa fa-archive"></i>
                Archive
            </a>
        </li>
        
        <li>
            <a href="https://suiyan.cc/tags.html">
                <i class="fa fa-tags"></i>
                Tags
            </a>
        </li>
        
        <li>
            <a href="https://suiyan.cc/aboutme.html">
                <i class="fa fa-user"></i>
                About Me
            </a>
        </li>
        
    </ul>
</nav>
</aside>
    </div>

</main>
<footer><div class="container">
    <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a>进行许可。
    <div><small>
        Powered by
    </small>
        <a href="https://github.com/Jsky2020/suiyan" target="_blank">
            SuiYan
        </a>
       <small> | </small>
        <small>
            Copyright
            <i aria-hidden="true" class="fa fa-copyright">
            </i>
            2017-2023
        </small>
    </div>
</div></footer>
<!-- Minimal theme switcher -->
<script src="https://suiyan.cc/assets/js/minimal-theme-switcher.js"></script>
<!-- Scroll to Top button selector -->
<a class="to-top"><i class="fa fa-chevron-up fa-3" aria-hidden="true"></i></a>
<script src="https://suiyan.cc/assets/js/jquery.toTop.min.js"></script>
<script>
        jQuery(function($){
            // Plugin activation (basic - with all default values)
            // $('.to-top').toTop();

            // Plugin activation with options
            $('.to-top').toTop({
                //options with default values
                autohide: true,  //boolean 'true' or 'false'
                offset: 420,     //numeric value (as pixels) for scrolling length from top to hide automatically
                speed: 500,      //numeric value (as mili-seconds) for duration
                position:true,   //boolean 'true' or 'false'. Set this 'false' if you want to add custom position with your own css
                right: 15,       //numeric value (as pixels) for position from right. It will work only if the 'position' is set 'true'
                bottom: 30       //numeric value (as pixels) for position from bottom. It will work only if the 'position' is set 'true'
            });
        });

</script>
</body>
</html>
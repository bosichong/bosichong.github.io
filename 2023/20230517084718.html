<!DOCTYPE html>
<html lang="zh-CN" data-bs-theme="dark">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="Python碎言博客" name="keywords">
    <meta content="博客的静态页面的生成都是由博客的基础数据支撑的，搜集博客的基本信息和博客文章数据，是生成博客静态文件的核心功能。" name="description">
    <meta content="J.sky" name="author">
    <link rel="icon" type="image/png" href="https://suiyan.cc/assets/images/favicon/favicon-32x32.png" sizes="32x32"/>
    <link rel="icon" type="image/png" href="https://suiyan.cc/assets/images/favicon/favicon-16x16.png" sizes="16x16"/>
    <title>使用Python编写并部署个人静态博客:(三)搜集博客数据 | SuiYan 碎言博客</title>

    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Template Main CSS File -->
    <link href="https://suiyan.cc/assets/css/style.css" rel="stylesheet">
</head>

<body>

<!-- ======= Mobile nav toggle button ======= -->
<i class="fa fa-navicon mobile-nav-toggle d-xl-none animate__animated"></i>

<!-- ======= Header ======= -->


<header id="header">
<div class="h-top d-flex flex-column">
    <div class="profile">
        <img src="https://suiyan.cc/assets/images/avatar.jpg" alt="" class="img-fluid rounded-circle">
        <h3 class="blog_author text-light"><a href="https://suiyan.cc/">J.sky</a></h3>
        <p class="blog-description">
            You see see you , This one day day di.
          </p>
        <div class="social-links mt-3 text-center">
            
            <a href="https://github.com/bosichong/suiyan" target="_blank"><i class="fa fa-github"></i></a>
            
            <a href="https://gitee.com/J_Sky/suiyan" target="_blank"><i class="fa fa-git"></i></a>
            
            <a href="mailto:285911@gmail.com" target="_blank"><i class="fa fa-envelope"></i></a>
            
            <a href="https://www.zhihu.com/people/J_sky/activities" target="_blank"><i class="fa fa-book"></i></a>
            
            <a href="https://suiyan.cc/rss.xml" target="_blank"><i class="fa fa-rss-square"></i></a>
            
        </div>
    </div>

    <nav id="navbar" class="nav-menu navbar">
        <ul>
            
            <li><a href="https://suiyan.cc/" class="nav-link scrollto active"><i class="fa fa-home"></i>
                <span>Home</span></a></li>
            
            <li><a href="https://suiyan.cc/archives.html" class="nav-link scrollto active"><i class="fa fa-archive"></i>
                <span>Archive</span></a></li>
            
            <li><a href="https://suiyan.cc/tags.html" class="nav-link scrollto active"><i class="fa fa-tags"></i>
                <span>Tags</span></a></li>
            
            <li><a href="https://suiyan.cc/before-2022/1.html" class="nav-link scrollto active"><i class="fa fa-user-md"></i>
                <span>About Me</span></a></li>
            
            <li><a href="https://suiyan.cc/links.html" class="nav-link scrollto active"><i class="fa fa-link"></i>
                <span>Links</span></a></li>
            
        </ul>
    </nav><!-- .nav-menu -->
</div>

    
        <div class="blog-search">
            <div>
                <input id="search-input" type="text" placeholder="JavaScript">
                <button type="button" id="search-btn" class="vibrate-1" data-bs-toggle="modal" data-bs-target="#exampleModal"><i class="fa fa-search"></i></button>
            </div>
        </div>
    </header>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">搜索结果</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <article>
                    <a href="#close"
                       aria-label="Close"
                       class="close"
                       data-target="modal-example"
                       onClick="toggleModal(event)">
                    </a>
                    <div id="modal" style="display: none;">
                        <ul id="result-list"></ul>
                    </div>
                </article>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
        </div>
    </div>


<!-- End Header -->

<main id="main">

    <section class="inner-page">
       


<hgroup class="blog-info">
    <h1 class="animate__animated animate__bounce">使用Python编写并部署个人静态博客:(三)搜集博客数据</h1>
    <small> 作者:<a href="#">J.sky</a> | 发表于:<span class="cr-time" data-bs-toggle="tooltip"  data-bs-title="2023-05-17 08:47:18">2023-05-17 08:47:18</span> | 更新于:<span class="up-time" data-bs-toggle="tooltip"  data-bs-title="2023-06-09 08:31:56">2023-06-09 08:31:56</span> | Tag:
        
        
        Python
        
        碎言博客
        
    </small>
</hgroup>

<div class="article animate__animated animate__fadeInUp">
    <p><a href="https://suiyan.cc/2023/20230410075954.html">使用Python编写并部署个人静态博客:(一)分析与设计</a></p>
<p><a href="https://suiyan.cc/2023/20230420101527.html">使用Python编写并部署个人静态博客:(二)实现静态页面的输出</a></p>
<p>使用Python编写并部署个人静态博客:(三)搜集博客数据</p>
<p><a href="https://suiyan.cc/2023/20230609081842.html">使用Python编写并部署个人静态博客:(四)逐步输出静态页面</a></p>
<h2>搜集博客数据</h2>
<p><img alt="在这里插入图片描述" src="https://suiyan.cc/assets/images/2023/b01.png" /></p>
<p>博客的静态页面的生成都是由博客的基础数据支撑的，搜集博客的基本信息和博客文章数据，是生成博客静态文件的核心功能。</p>
<h2>博客的基础配置</h2>
<p>每个博客都会有一些最基础的配置，例如博客的名称、简介、站长的昵称头像等，我们可以把这些基础的数据设置为一个配置文件，这里我使用了JSON格式的配置文件。可以在站点的根目录下创建一个config.json，其内容格式大概如下，可以根据自己的需要添加修改。</p>
<pre><code>{
    "dev": 0,
    "blog_name": "碎言博客",
    "blog_name_en": "SuiYan",
    "blog_author": "J.sky",
    "blog_description_en": "You see see you , This one day day di.",
    "blog_typed": [
        "Life is short, you need Python",
        "人生苦短，我用Python.",
        "Beautiful is better than ugly.",
        "美丽优于丑陋.",
        "Explicit is better than implicit.",
        "直白优于含蓄.",
        "Simple is better than complex.",
        "简单优于复杂.",
        "Complex is better than complicated.",
        "复杂优于繁琐.",
        "Readability counts.",
        "可读性很重要."
    ],
    "meta_description": " Python Django JavaScript 学习讨论,我们是一群热爱Python的程序员，人生苦短，我用JavaScript！一个不会JavaScript的Python开发者不是一个好网管。",
    "meta_keywords":"Python,Django,JavaScript,程序员,人生苦短,我用Python",
    "profile_image":"assets/images/avatar.jpg",
    "blog_bg": "assets/images/bg.jpg",
    "theme": "my_blog",
    "build": "blog",
    "md_dir": "articles",
    "blog_page_num":8,
    "blog_test_url":"http://127.0.0.1:5501/",
    "blog_url":"https://suiyan.cc/",
    "blog_sns": [
        {
            "ico": "github",
            "url": "https://github.com/bosichong/suiyan"
        },
        {
            "ico": "git",
            "url": "https://gitee.com/J_Sky/suiyan"
        },
        {
            "ico": "envelope",
            "url": "mailto:285911@gmail.com"
        },
        {
            "ico": "book",
            "url": "https://www.zhihu.com/people/J_sky/activities"
        },
        {
            "ico": "rss-square",
            "url": "https://suiyan.cc/rss.xml"
        }
    ],
    "nav": [
        {
            "ico": "home",
            "text": "Home",
            "url": ""
        },
        {
            "ico": "archive",
            "text": "Archive",
            "url": "archives.html"
        },
        {
            "ico": "tags",
            "text": "Tags",
            "url": "tags.html"
        },
        {
            "ico": "user-md",
            "text": "About Me",
            "url": "aboutme.html"
        },
        {
            "ico": "link",
            "text": "Links",
            "url": "links.html"
        }
    ]

}
</code></pre>
<p>然后就可以在程序的文件中组织这些最基础的配置，例如提取文件地址和内容，分配静态文件生成发布的目录等，使用一些常量来定他们，放到代码的最顶部。</p>
<pre><code>APP_CONFIG = "config_my.json"
BASE_DIR = os.path.dirname(os.path.abspath(__file__))  # 当前目录地址
CONFIG = load_configjson(os.path.join(BASE_DIR, APP_CONFIG))  # 获取当前配置
BLOGPAGES = os.path.join(BASE_DIR, CONFIG["build"])  # 所有静态资源存放目录
ARTICLES_DIR = os.path.join(BASE_DIR, CONFIG["md_dir"])  # 博文目录
THEME = os.path.join(BASE_DIR, "theme")  # 主题目录
CONFIGJSON = os.path.join(BASE_DIR, APP_CONFIG)
BLOGCONFIG = os.path.join(BLOGPAGES, 'config.json')
BLOGDATAJSON = os.path.join(BLOGPAGES, 'blog_data.json')
SUIYANVERSION = "3.1.0"  # 程序版本
</code></pre>
<p>通过Python读写文件的操作，定义一个方法从磁盘上来获取config.json的内容并转化为Python的字典：</p>
<pre><code>def load_configjson(jsonpath):
    """载入blog配置文件config.json"""
    config_code = loadcode(jsonpath)
    config = json.loads(config_code)
    return config
</code></pre>
<p>具体的代码可以查看碎言静态博客的代码仓库，这里只介绍一些项目的架构技巧。</p>
<h2>博客文章以及其他相关数据的搜集</h2>
<p>博客的静态文件除了基础的博客信息外，还有博客的归档、分类(标签)、博客页面的数据等，这些都需要从博客文章的Markdown文件数据集中计算得出。
这里我采用了从文章目录中搜集博客文章，读取文章头部的定义内容，组织这些数据创建一个blog.json的索引，这个索引可以用来生成归档和标签页面的内容，也可以用来作为搜索的依据。</p>
<p>具体通过递归扫描文章目录来生成：</p>
<pre><code>def create_blogdata_json(adir):
    """
    递归获得当前目录及其子目录中所有的.md文件列表。
    并创建blog的data索引JSON
    :param adir: 文章日志所在目录
    :param bdir: 站点根目录
    :return: json字符串
    """
    data_json = []
    # 当前目录下所有的文件、子目录、子目录下的文件。
    for root, dirs, files in os.walk(adir):
        for file in files:
            # 值读取.md
            if file.endswith('.md'):
                url = os.path.join(root, file).replace(
                    adir + os.sep, '').replace('.md', '')  # 最后需要组装的相对目录
                furl = os.path.join(root, file)  # 当前文件的绝对目录
                f_data = extract_md_header(furl)  # 获取.md的文章信息转成字典
                f_data["url"] = url
                f_data["uptime"] = get_file_modification_time(os.path.join(root, file))
                data_json.append(f_data)  # 添加到需要返回的数据数组中

    data_json.sort(key=lambda x: x["time"], reverse=True)  # 对数组进行降序排序
    data_json_str = json.dumps(data_json, ensure_ascii=False)  # 转化为json字符串
    return data_json_str
</code></pre>
<p>有了这个文章数据之后，基本上就是解决了所有的静态博客文件生成依赖了。之后我们就可以编写代码，依次或是批量生成相关的页面了。</p>
</div>

<div class="blog_footer">
    <div class="prev_next">
        
        <a href="https://suiyan.cc/2023/20230518092845.html" class="text-truncate">< <span>Django 4.2 复习笔记(一)迅速概览</span></a>
        

        
        <a href="https://suiyan.cc/2023/20230516211444.html" class="text-truncate"><span>一款基于GitHub的评论系统不但免费安装还贼简单！</span> ></a>
        
    </div>
    
    <div class="related">
        <p>
            相关文章：
        </p>
        <ul>
            
            <li>
                <a href="https://suiyan.cc/2023/20230420101527.html" class="text-truncate "><span>使用Python编写并部署个人静态博客:(二)实现静态页面的输出</span></a>
            </li>
            
            <li>
                <a href="https://suiyan.cc/2023/20230410075954.html" class="text-truncate "><span>使用Python编写并部署个人静态博客:(一)分析与设计</span></a>
            </li>
            
            <li>
                <a href="https://suiyan.cc/before-2022/20210212002001.html" class="text-truncate "><span>Anaconda常用终端命令</span></a>
            </li>
            
            <li>
                <a href="https://suiyan.cc/before-2022/20201202155245.html" class="text-truncate "><span>如何打包上传Python程序或模块包到PyPi供其他人使用pip下载？</span></a>
            </li>
            
            <li>
                <a href="https://suiyan.cc/before-2022/20201005203404.html" class="text-truncate "><span>聊聊Python中的装饰器</span></a>
            </li>
            
            <li>
                <a href="https://suiyan.cc/before-2022/20200330193816.html" class="text-truncate "><span>pip临时修改下载源</span></a>
            </li>
            
            <li>
                <a href="https://suiyan.cc/2023/20230609081842.html" class="text-truncate "><span>使用Python编写并部署个人静态博客:(四)逐步输出静态页面</span></a>
            </li>
            
            <li>
                <a href="https://suiyan.cc/2023/20230427151750.html" class="text-truncate "><span>coding_blog 碎言静态博客主题</span></a>
            </li>
            
            <li>
                <a href="https://suiyan.cc/2023/20230420162736.html" class="text-truncate "><span>simple_blog 碎言静态博客主题</span></a>
            </li>
            
            <li>
                <a href="https://suiyan.cc/2023/20230408093536.html" class="text-truncate "><span>free_blog 碎言静态博客主题</span></a>
            </li>
            
        </ul>

    </div>
    

    <script src="https://giscus.app/client.js"
        data-repo="bosichong/bosichong.github.io"
        data-repo-id="R_kgDOJLHieA"
        data-category="Announcements"
        data-category-id="DIC_kwDOJLHieM4CWhL8"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="dark"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>

</div>


<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/base16/onedark.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>


    </section>

</main><!-- End #main -->

<!-- ======= Footer ======= -->
<footer id="footer">
<div class="container">
    <div class="copyright">
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a>
    </div>

    <div class="credits">
        Designed by <a href="https://github.com/Jsky2020/suiyan" target="_blank">SuiYan</a> | Theme by <a href="https://github.com/bosichong/coding_blog" target="_blank">Coding-blog</a>
    </div>
</div>
</footer><!-- End  Footer -->
<a href="#" class="back-to-top d-flex align-items-center justify-content-center animate__animated"><i class="fa fa-arrow-up"></i></a>
<!-- Vendor JS Files -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<!-- CDN example (unpkg) day.js -->
<script src="https://unpkg.com/dayjs@1.8.21/dayjs.min.js"></script>
<script src="https://unpkg.com/dayjs@1.8.21/plugin/relativeTime.js"></script>
<script src="https://unpkg.com/dayjs@1.8.21/locale/zh-cn.js"></script>

<!-- Template Main JS File -->
<script src="https://suiyan.cc/assets/js/url.js"></script>
<script src="https://suiyan.cc/assets/js/main.js"></script>

</body>

</html>
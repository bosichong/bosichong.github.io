<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta content="Python碎言博客" name="keywords" />
    <meta content="博客的静态页面的生成都是由博客的基础数据支撑的，搜集博客的基本信息和博客文章数据，是生成博客静态文件的核心功能。" name="description" />
    <meta content="J.sky" name="author" />
    <link
      rel="icon"
      type="image/png"
      href="https://suiyan.cc/assets/images/favicon/favicon-32x32.png"
      sizes="32x32"
    />
    <link
      rel="icon"
      type="image/png"
      href="https://suiyan.cc/assets/images/favicon/favicon-16x16.png"
      sizes="16x16"
    />
    <title>
      使用Python编写并部署个人静态博客:(三)搜集博客数据 | SuiYan 碎言
    </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://suiyan.cc/assets/js/tailwind.config.js"></script>

    <!-- Template Main CSS File -->
    <link href="https://suiyan.cc/assets/css/style.css" rel="stylesheet" />

    <!-- CDN example (unpkg) day.js -->
    <script src="https://suiyan.cc/assets/js/dayjs.min.js"></script>
    <script src="https://suiyan.cc/assets/js/relativeTime.js"></script>
    <script src="https://suiyan.cc/assets/js/zh-cn.js"></script>

    <!-- Template Main JS File -->
    <script src="https://suiyan.cc/assets/js/main.js"></script>
  </head>

  <body>
    <nav class="sticky top-0 h-16 px-4 z-10 bg-opacity-90 backdrop-blur">
      <div class="container h-16 xl:w-3/5 mx-auto flex items-center">
        <div class="justify-start w-1/5">
          <div class="w-16 text-center text-2xl hover:animate-bounce">
            <a href="https://suiyan.cc/">碎言</a>
          </div>
        </div>
        <div class="justify-end w-4/5 flex">
          <ul class="flex text-center text-sm gap-6 list-none">
            
            <li class="hover:animate-bounce">
              <a
                href="https://suiyan.cc/archives.html"
                class="text-gray-500 transition hover:text-gray-500/75"
              >
                归档</a
              >
            </li>
            
            <li class="hover:animate-bounce">
              <a
                href="https://suiyan.cc/tags.html"
                class="text-gray-500 transition hover:text-gray-500/75"
              >
                标签</a
              >
            </li>
            
            <li class="hover:animate-bounce">
              <a
                href="https://suiyan.cc/before-2022/1.html"
                class="text-gray-500 transition hover:text-gray-500/75"
              >
                关于</a
              >
            </li>
            
            <li class="hover:animate-bounce">
              <a
                href="https://suiyan.cc/links.html"
                class="text-gray-500 transition hover:text-gray-500/75"
              >
                链接</a
              >
            </li>
            
            <li class="hover:animate-bounce">
                  <a href="https://suiyan.cc/search.html" aria-label="Search page">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="icon icon-tabler icon-tabler-search"
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                      stroke="currentColor"
                      fill="none"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                      <path
                        d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0"
                      ></path>
                      <path d="M21 21l-6 -6"></path>
                    </svg>
                  </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div
      class="container max-w-3xl mx-auto leading-normal text-lg font-extralight"
    >
      <div class="p-4">
<!-- Template Main CSS File -->
<link href="https://suiyan.cc/assets/css/blog.css" rel="stylesheet">
<link rel="stylesheet"
      href="https://suiyan.cc/assets/css/default.min.css">
<script src="https://suiyan.cc/assets/js/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

  <div class="mb-4">
    <h1 class="text-3xl font-medium">使用Python编写并部署个人静态博客:(三)搜集博客数据</h1>
    <div class="text-sm flex flex-wrap my-2">
      作者:<a href="#">J.sky</a> · 发表于:<div class="tooltip" data-tip="2023-05-17 08:47:18"><span
        class="cr-time"
        >2023-05-17 08:47:18</span></div>
      · 更新于:<div class="tooltip" data-tip="2023-06-13 19:41:20"><span class="up-time">2023-06-13 19:41:20</span></div>
      · Tag:   Python  碎言博客 
      </small>
    </div>
  </div>

  <div class="mb-4"><p><a href="https://suiyan.cc/2023/20230410075954.html">使用Python编写并部署个人静态博客:(一)分析与设计</a></p>
<p><a href="https://suiyan.cc/2023/20230420101527.html">使用Python编写并部署个人静态博客:(二)实现静态页面的输出</a></p>
<p><a href="https://suiyan.cc/2023/20230517084718.html">使用Python编写并部署个人静态博客:(三)搜集博客数据</a></p>
<p><a href="https://suiyan.cc/2023/20230609081842.html">使用Python编写并部署个人静态博客:(四)逐步输出静态页面</a></p>
<p><a href="https://suiyan.cc/2023/20230613193700.html">使用Python编写并部署个人静态博客:(五)Python异步输出博文页面</a></p>
<h2>搜集博客数据</h2>
<p><img alt="在这里插入图片描述" src="https://suiyan.cc/assets/images/2023/b01.png" /></p>
<p>博客的静态页面的生成都是由博客的基础数据支撑的，搜集博客的基本信息和博客文章数据，是生成博客静态文件的核心功能。</p>
<h2>博客的基础配置</h2>
<p>每个博客都会有一些最基础的配置，例如博客的名称、简介、站长的昵称头像等，我们可以把这些基础的数据设置为一个配置文件，这里我使用了JSON格式的配置文件。可以在站点的根目录下创建一个config.json，其内容格式大概如下，可以根据自己的需要添加修改。</p>
<pre><code>{
    "dev": 0,
    "blog_name": "碎言博客",
    "blog_name_en": "SuiYan",
    "blog_author": "J.sky",
    "blog_description_en": "You see see you , This one day day di.",
    "blog_typed": [
        "Life is short, you need Python",
        "人生苦短，我用Python.",
        "Beautiful is better than ugly.",
        "美丽优于丑陋.",
        "Explicit is better than implicit.",
        "直白优于含蓄.",
        "Simple is better than complex.",
        "简单优于复杂.",
        "Complex is better than complicated.",
        "复杂优于繁琐.",
        "Readability counts.",
        "可读性很重要."
    ],
    "meta_description": " Python Django JavaScript 学习讨论,我们是一群热爱Python的程序员，人生苦短，我用JavaScript！一个不会JavaScript的Python开发者不是一个好网管。",
    "meta_keywords":"Python,Django,JavaScript,程序员,人生苦短,我用Python",
    "profile_image":"assets/images/avatar.jpg",
    "blog_bg": "assets/images/bg.jpg",
    "theme": "my_blog",
    "build": "blog",
    "md_dir": "articles",
    "blog_page_num":8,
    "blog_test_url":"http://127.0.0.1:5501/",
    "blog_url":"https://suiyan.cc/",
    "blog_sns": [
        {
            "ico": "github",
            "url": "https://github.com/bosichong/suiyan"
        },
        {
            "ico": "git",
            "url": "https://gitee.com/J_Sky/suiyan"
        },
        {
            "ico": "envelope",
            "url": "mailto:285911@gmail.com"
        },
        {
            "ico": "book",
            "url": "https://www.zhihu.com/people/J_sky/activities"
        },
        {
            "ico": "rss-square",
            "url": "https://suiyan.cc/rss.xml"
        }
    ],
    "nav": [
        {
            "ico": "home",
            "text": "Home",
            "url": ""
        },
        {
            "ico": "archive",
            "text": "Archive",
            "url": "archives.html"
        },
        {
            "ico": "tags",
            "text": "Tags",
            "url": "tags.html"
        },
        {
            "ico": "user-md",
            "text": "About Me",
            "url": "aboutme.html"
        },
        {
            "ico": "link",
            "text": "Links",
            "url": "links.html"
        }
    ]

}
</code></pre>
<p>然后就可以在程序的文件中组织这些最基础的配置，例如提取文件地址和内容，分配静态文件生成发布的目录等，使用一些常量来定他们，放到代码的最顶部。</p>
<pre><code>APP_CONFIG = "config_my.json"
BASE_DIR = os.path.dirname(os.path.abspath(__file__))  # 当前目录地址
CONFIG = load_configjson(os.path.join(BASE_DIR, APP_CONFIG))  # 获取当前配置
BLOGPAGES = os.path.join(BASE_DIR, CONFIG["build"])  # 所有静态资源存放目录
ARTICLES_DIR = os.path.join(BASE_DIR, CONFIG["md_dir"])  # 博文目录
THEME = os.path.join(BASE_DIR, "theme")  # 主题目录
CONFIGJSON = os.path.join(BASE_DIR, APP_CONFIG)
BLOGCONFIG = os.path.join(BLOGPAGES, 'config.json')
BLOGDATAJSON = os.path.join(BLOGPAGES, 'blog_data.json')
SUIYANVERSION = "3.1.0"  # 程序版本
</code></pre>
<p>通过Python读写文件的操作，定义一个方法从磁盘上来获取config.json的内容并转化为Python的字典：</p>
<pre><code>def load_configjson(jsonpath):
    """载入blog配置文件config.json"""
    config_code = loadcode(jsonpath)
    config = json.loads(config_code)
    return config
</code></pre>
<p>具体的代码可以查看碎言静态博客的代码仓库，这里只介绍一些项目的架构技巧。</p>
<h2>博客文章以及其他相关数据的搜集</h2>
<p>博客的静态文件除了基础的博客信息外，还有博客的归档、分类(标签)、博客页面的数据等，这些都需要从博客文章的Markdown文件数据集中计算得出。
这里我采用了从文章目录中搜集博客文章，读取文章头部的定义内容，组织这些数据创建一个blog.json的索引，这个索引可以用来生成归档和标签页面的内容，也可以用来作为搜索的依据。</p>
<p>具体通过递归扫描文章目录来生成：</p>
<pre><code>def create_blogdata_json(adir):
    """
    递归获得当前目录及其子目录中所有的.md文件列表。
    并创建blog的data索引JSON
    :param adir: 文章日志所在目录
    :param bdir: 站点根目录
    :return: json字符串
    """
    data_json = []
    # 当前目录下所有的文件、子目录、子目录下的文件。
    for root, dirs, files in os.walk(adir):
        for file in files:
            # 值读取.md
            if file.endswith('.md'):
                url = os.path.join(root, file).replace(
                    adir + os.sep, '').replace('.md', '')  # 最后需要组装的相对目录
                furl = os.path.join(root, file)  # 当前文件的绝对目录
                f_data = extract_md_header(furl)  # 获取.md的文章信息转成字典
                f_data["url"] = url
                f_data["uptime"] = get_file_modification_time(os.path.join(root, file))
                data_json.append(f_data)  # 添加到需要返回的数据数组中

    data_json.sort(key=lambda x: x["time"], reverse=True)  # 对数组进行降序排序
    data_json_str = json.dumps(data_json, ensure_ascii=False)  # 转化为json字符串
    return data_json_str
</code></pre>
<p>有了这个文章数据之后，基本上就是解决了所有的静态博客文件生成依赖了。之后我们就可以编写代码，依次或是批量生成相关的页面了。</p></div>

  <div class="blog_footer">
    <div class="prev_next flex justify-between my-4">
      
      <a href="https://suiyan.cc/2023/20230516211444.html" class="text-accent text-md"
        ><button class="btn"> prev </button></a
      >
       
      <a href="https://suiyan.cc/2023/20230518092845.html" class="text-accent text-md"
        ><button class="btn"> next </button></a
      >
      
    </div>
    
    <div class="related">
      <p>相关文章：</p>
      <ul>
        
        <li class="list-group-item">
          <a href="https://suiyan.cc/2023/20230706084131.html" class="link link-hover"
            ><span>编程新手学习过程中如何更好的提问？</span></a
          >
        </li>
        
        <li class="list-group-item">
          <a href="https://suiyan.cc/2023/20230420101527.html" class="link link-hover"
            ><span>使用Python编写并部署个人静态博客:(二)实现静态页面的输出</span></a
          >
        </li>
        
        <li class="list-group-item">
          <a href="https://suiyan.cc/2023/20230410075954.html" class="link link-hover"
            ><span>使用Python编写并部署个人静态博客:(一)分析与设计</span></a
          >
        </li>
        
        <li class="list-group-item">
          <a href="https://suiyan.cc/before-2022/20210212002001.html" class="link link-hover"
            ><span>Anaconda常用终端命令</span></a
          >
        </li>
        
        <li class="list-group-item">
          <a href="https://suiyan.cc/before-2022/20201202155245.html" class="link link-hover"
            ><span>如何打包上传Python程序或模块包到PyPi供其他人使用pip下载？</span></a
          >
        </li>
        
        <li class="list-group-item">
          <a href="https://suiyan.cc/before-2022/20201005203404.html" class="link link-hover"
            ><span>聊聊Python中的装饰器</span></a
          >
        </li>
        
        <li class="list-group-item">
          <a href="https://suiyan.cc/before-2022/20200330193816.html" class="link link-hover"
            ><span>pip临时修改下载源</span></a
          >
        </li>
        
        <li class="list-group-item">
          <a href="https://suiyan.cc/2023/20230718150806.html" class="link link-hover"
            ><span>速度与优雅：博客性能优化之旅</span></a
          >
        </li>
        
        <li class="list-group-item">
          <a href="https://suiyan.cc/2023/20230717103801.html" class="link link-hover"
            ><span>久了，博客主题就会一直做减法</span></a
          >
        </li>
        
        <li class="list-group-item">
          <a href="https://suiyan.cc/2023/20230617102523.html" class="link link-hover"
            ><span>从一次浏览器兼容问题到何不放过自己做个快乐的博主</span></a
          >
        </li>
        
      </ul>
    </div>
    
    <!-- <div class="mb-4 my-2 flex flex-wrap items-center justify-center gap-2">
      <button id="load-comments-btn" class="btn btn-wide">加载评论</button>
      <div id="comments-container" class="w-full"></div>
    </div> -->

  </div>

  <script src="https://giscus.app/client.js"
  data-repo="bosichong/bosichong.github.io"
  data-repo-id="R_kgDOJLHieA"
  data-category="Announcements"
  data-category-id="DIC_kwDOJLHieM4CWhL8"
  data-mapping="title"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-input-position="bottom"
  data-theme="preferred_color_scheme"
  data-lang="zh-CN"
  data-loading="lazy"
  crossorigin="anonymous"
  async>
</script>





</div>

      <!-- ======= Footer ======= -->

      <footer class="footer grid grid-flow-col text-sm p-3 bg-slate-100 text-base-content">
  <div>
    <div>
      本站采用<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank">知识共享署名-相同方式共享 4.0 国际许可协议</a>进行许可，转载请保留原文链接及署名。
    </div>
    <div>
      Designed by
      <a href="https://github.com/Jsky2020/suiyan" target="_blank">SuiYan</a>
      <script type="text/javascript" src="//js.users.51.la/21737767.js"></script>
    </div>
  </div>

  <div>
    <span class="footer-title">Contact me</span>
    <div class="grid grid-flow-col gap-2 text-lg">
      
      <a href="https://github.com/bosichong/suiyan" target="_blank" style="width: 24px; height: 24px;"
        ><img width="24" height="24" src="https://suiyan.cc/assets/ico/github.png" alt="github" class="hover:animate-bounce"></a>
      
      <a href="https://gitee.com/J_Sky/suiyan" target="_blank" style="width: 24px; height: 24px;"
        ><img width="24" height="24" src="https://suiyan.cc/assets/ico/gitee.png" alt="gitee" class="hover:animate-bounce"></a>
      
      <a href="mailto:285911@gmail.com" target="_blank" style="width: 24px; height: 24px;"
        ><img width="24" height="24" src="https://suiyan.cc/assets/ico/mail.png" alt="mail" class="hover:animate-bounce"></a>
      
      <a href="https://suiyan.cc/rss.xml" target="_blank" style="width: 24px; height: 24px;"
        ><img width="24" height="24" src="https://suiyan.cc/assets/ico/rss.png" alt="rss" class="hover:animate-bounce"></a>
      
    </div>
  </div>
</footer>

      <!-- End  Footer -->
    </div>

    <div class="rightside fixed bottom-20 right-2 w-10">
      <!-- Component: Base secondary button with icon  -->
      <button
        aria-label="arrow-up"
        onclick="scrollToTop()"
        class="hover:animate-bounce mb-2 inline-flex items-center self-center justify-center h-10 gap-2 px-5 text-sm font-medium tracking-wide transition duration-300 rounded-full focus-visible:outline-none justify-self-center whitespace-nowrap bg-zinc-50 text-zinc-500 hover:bg-zinc-100 hover:text-zinc-600 focus:bg-zinc-200 focus:text-zinc-700 disabled:cursor-not-allowed disabled:border-zinc-300 disabled:bg-zinc-100 disabled:text-zinc-400 disabled:shadow-none"
      >
        <span class="relative only:-mx-5">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="icon icon-tabler icon-tabler-square-rounded-arrow-up"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="2"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path d="M16 12l-4 -4l-4 4"></path>
            <path d="M12 16v-8"></path>
            <path
              d="M12 3c7.2 0 9 1.8 9 9s-1.8 9 -9 9s-9 -1.8 -9 -9s1.8 -9 9 -9z"
            ></path>
          </svg>
        </span>
      </button>
      <!-- End Base secondary button with icon  -->
    </div>
  </body>
</html>
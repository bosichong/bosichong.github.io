<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="Python,Django,JavaScript,程序员,人生苦短,我用Python" name="keywords">
    <meta content=" Python Django JavaScript 学习讨论,我们是一群热爱Python的程序员，人生苦短，我用JavaScript！一个不会JavaScript的Python开发者不是一个好网管。" name="description">
    <meta content="J.sky" name="author">
    <title>SuiYan 碎言博客  List Pages 第19页</title>
    <!-- 引入 pico.css -->
    <link rel="stylesheet" href="https://suiyan.cc/assets/css/pico.min.css">
    <!-- 引入 图标CDN -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 引入 站点样式 -->
    <link rel="stylesheet" href="https://suiyan.cc/assets/css/custom.css">
    <script src="https://suiyan.cc/assets/js/jquery-3.3.1.min.js"></script>
    
</head>
<body>
<div class="hero" data-theme="dark" style="background-image: url('https://suiyan.cc/assets/images/bg.jpg');">
    <nav class="container-fluid"><ul>
    <li><a href="https://suiyan.cc/" class="contrast">SuiYan</a></li>
</ul>
<ul>
    <li>
        <details role="list" dir="rtl">
            <summary aria-haspopup="listbox" role="link" class="contrast">Theme</summary>
            <ul role="listbox">
                <li><a href="#" data-theme-switcher="auto">Auto</a></li>
                <li><a href="#" data-theme-switcher="light">Light</a></li>
                <li><a href="#" data-theme-switcher="dark">Dark</a></li>
            </ul>
        </details>
    </li>
</ul></nav>
    <head><header class="container">
    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
    <hgroup class="hd">
        <img class="avatar" src="https://suiyan.cc/assets/images/avatar.jpg"/>
        <div><span id="typed"></span></div>
        <ul class="sns-ul">
            
            <li class="sns-li">
                <a href="https://github.com/bosichong/suiyan" target="_blank">
                    <i class="fa fa-github "></i>
                </a>
            </li>
            
            <li class="sns-li">
                <a href="https://gitee.com/J_Sky/suiyan" target="_blank">
                    <i class="fa fa-git "></i>
                </a>
            </li>
            
            <li class="sns-li">
                <a href="https://weibo.com/qq285911" target="_blank">
                    <i class="fa fa-weibo "></i>
                </a>
            </li>
            
            <li class="sns-li">
                <a href="https://user.qzone.qq.com/285911/" target="_blank">
                    <i class="fa fa-qq "></i>
                </a>
            </li>
            
            <li class="sns-li">
                <a href="https://www.zhihu.com/people/J_sky/activities" target="_blank">
                    <i class="fa fa-book "></i>
                </a>
            </li>
            
            <li class="sns-li">
                <a href="https://suiyan.cc/rss.xml" target="_blank">
                    <i class="fa fa-rss "></i>
                </a>
            </li>
            
        </ul>
    </hgroup>
    <script>
        const typed = new Typed('#typed', {
          strings: [
          
          'Life is short, you need Python',
          
          '人生苦短，我用Python.',
          
          'Beautiful is better than ugly.',
          
          '美丽优于丑陋.',
          
          'Explicit is better than implicit.',
          
          '直白优于含蓄.',
          
          'Simple is better than complex.',
          
          '简单优于复杂.',
          
          'Complex is better than complicated.',
          
          '复杂优于繁琐.',
          
          'Readability counts.',
          
          '可读性很重要.',
          
          ],
          typeSpeed: 100,
          backSpeed: 10,
          backDelay: 100,
          startDelay: 1000,
          loop:true
    });
  </script>
</header></head>
</div>
<main class="container">
    <div class="grid">
        <section>



<hgroup>
    <h2>你与黑客之间差了多少行Python代码？</h2>
    <h3> 作者:<a href="#">J.sky</a> | <small>发表于:2017-10-10 15:23:17</small> | <small>更新于:2023-04-08 08:48:33</small> | Tag:
        
        
        <samll>Python基础</samll>
        
    </h3>
</hgroup>
<p><p><img alt="输入图片说明" src="https://suiyan.cc/assets/images/media/upload/2017/10/Snip20171010_11.png" /></p>
<p>雷布斯曾说过：“必须写够十万行代码，不要心存侥幸。没有写过足够代码量的，想成为高手是不可能的，只能纸上谈兵！”，看来要成一名黑客10万代码量也许只是个起步。那么自己与黑客差了多少呢，要不咱统计一下吧。</p>
<h2>编写思路</h2>
<p>程序的编写思路其实很简单：统计自己编写过的.py文件，然后统计文件行数累加到一起就ok。</p>
<p><code>os.walk</code>这个方法可以统计当前目录下所有的文件、子目录、子目录下的文件，有了这个数据，我们只需要排除掉不需要的，统计以.py为结尾的文件目录地址加入一个列表即可。</p>
<p>有了所有.py文件的列表，循环迭代出每个文件的行数，加到一起总数据就出来了。具体实现请看代码：</p>
<pre><code class="python">import os
def getpys(dir):
    '''
    递归获得当前目录及其子目录中所有的.py文件列表。
    '''
    pys = []
    # 当前目录下所有的文件、子目录、子目录下的文件。
    for root, dirs, files in os.walk(dir):
        for name in files:
            #排除掉git目录中的备份的文件，只保留.py文件
            if '.git' not in root and name.endswith('.py'):
                pys.append(os.path.join(root, name))
        #下边是拼装所有目录
        # for name in dirs:
        #     print(os.path.join(root, name))
    return pys
pys = getpys(os.path.dirname(__file__))
# print(pys)
hacker=100000#假设黑客需要10万行代码才能练成
lines = 0
for file in pys:
    with open(file, mode='r', encoding='utf8') as f:
        lines = lines + len(f.readlines())#统计每个文件的行数。
print("累计编写了源文件{0}个,手打{1}行Python代码，完成度{2:.2f}%".format(len(pys),lines,lines/hacker*100))
print("距离成为一名黑客还差{0}行代码".format(hacker-lines))
</code></pre>

<p>累计编写了源文件32个,手打2133行Python代码，完成度2.13%
距离成为一名黑客还差97867行代码</p>
<p>这个数量有点惨。。。不过我会努力的。</p>
<h2>本文源码下载：</h2>
<ul>
<li><a href="https://github.com/bosichong/17python.com/blob/master/counttest.py">github</a></li>
<li><a href="https://gitee.com/J_Sky/17python.com/blob/master/counttest.py">开源中国码云镜像gitee</a></li>
</ul></p>


<hr>
<br>


<hgroup>
    <h2>一些站长常用的搜索收录、访问统计平台</h2>
    <h3> 作者:<a href="#">J.sky</a> | <small>发表于:2017-10-09 20:45:57</small> | <small>更新于:2023-03-25 00:01:19</small> | Tag:
        
        
        <samll>站长吐槽</samll>
        
    </h3>
</hgroup>
<p><ul>
<li>
<p><a href="http://ziyuan.baidu.com">百度搜索资源平台</a></p>
</li>
<li>
<p><a href="http://union.baidu.com">百度联盟</a></p>
</li>
<li>
<p><a href="http://zhanzhang.so.com/">360站长平台</a></p>
</li>
<li>
<p><a href="http://ce.baidu.com/">百度云观测</a></p>
</li>
<li>
<p><a href="http://ziyuan.baidu.com">百度搜索资源平台</a></p>
</li>
<li>
<p><a href="http://www.jiathis.com/">JiaThis社会化分享按钮</a></p>
</li>
<li>
<p><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) </a></p>
</li>
<li>
<p><a href="http://changyan.kuaizhan.com/">畅言网站评论系统</a></p>
</li>
<li>
<p><a href="http://zhanzhang.sogou.com">搜狗站长平台</a></p>
</li>
<li>
<p><a href="https://web.umeng.com/main.php?c=site&amp;a=add">CNZZ站长统计数据专家</a></p>
</li>
<li>
<p><a href="http://www.miitbeian.gov.cn/">工信部ICP备案查询</a></p>
</li>
<li>
<p><a href="http://www.beian.gov.cn/">全国公安机关互联网安全服务备案</a></p>
</li>
</ul></p>


<hr>
<br>


<hgroup>
    <h2>聊聊Python闭包（Closure）的那点事。</h2>
    <h3> 作者:<a href="#">J.sky</a> | <small>发表于:2017-10-09 15:36:19</small> | <small>更新于:2023-03-25 00:01:19</small> | Tag:
        
        
        <samll>Python基础</samll>
        
    </h3>
</hgroup>
<p><p>记得当年学<code>JavaScript</code>时，对闭包的认识那真是朦朦胧胧，后来接触到<code>jQuery</code>之后，对闭包的认识还是一知半解，可能被之前一直学习本分的静态语言<code>java</code>给耽误了。。。。。。好吧，闭包到是个什么？是一个让初学编程的人头疼的问题</p>
<h2>Pythib闭包</h2>
<p>先来一个栗子，我们慢慢理顺一下：</p>
<pre><code class="python">def callf():
    def hello():
        return "hello world"
    return hello

cf = callf() #创建一个callf函数，这时把hello()赋值给了cf
print(type(cf)) # 查看cf类型，证实上边的结论。
print(cf()) #打印最终结果。
</code></pre>

<p>在一个函数中，把这个函数内部的一个函数做为返回值，那个这个被返回的函数就可以叫做闭包。（这条是本人自己写的，和网上其它处的理论会有些出入或是不同）
上边就算是闭包最简单的例子，多看几次应该就理解了。</p>
<p>再看下边的例子,这是一个利用闭包设计的简单自减计数器，其实我第一眼看去的时候就觉得为什么要这么写？</p>
<pre><code class="python">def countdown(n):
    def next():
        nonlocal n 
        r = n 
        n -= 1
        return r
    return next

nt = countdown(5)
while True:
    v = nt()
    print(v)
    if not v :break
</code></pre>

<p>这个自减计数器的应该还有几种其它写法，而且加之使用nonlocal这个关键字，使人更加迷惑了，如果注释掉<code>nonlocal n</code>，程序运行就会抛出错误，可见nonlocal的使用使next()函数内部变量<code>n</code>的值可以修改。 本人对此得的理解也不是很好，希望有大侠给与指点，也许这个例子不太理想。</p>
<h1>再看循环中的闭包：</h1>
<pre><code class="python">def loop():
    fs = []
    for i in range(1,4):
        def f():
            return i*i
        fs.append(f)
    return fs
f1,f2,f3 = loop()
print(f1())
</code></pre>

<p><code>f1()</code>的打印竟然9，这个有点出乎意料！我们修改一下这个函数</p>
<pre><code class="python">def loop(): 
    def f(j):
        return lambda: j*j
    fs = []
    for i in range(1,4):
        fs.append(f(i))       
    return fs
f1,f2,f3 = loop()
print(f1())
print(f2())
print(f3())
</code></pre>

<p>对比上边的两段代码，第一段直接返回了三次循环的最终结果，而第二段代码，再循环中遇到了<code>f()</code>函数<code>return</code>所以暂停了程序的运行，直到第二个赋值时又循环了一次，然后继续，这也说明，闭包的函数不要放在循环体内，不然直接返回的是循环的最终结果。
有的同学会问，了解闭包有什么用？闭包是装饰器和生成器的基础，如果你应用<code>Python</code>函数的高级应用，不妨仔细的了解一下闭包吧。</p>
<h2>参考文档</h2>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/22229197">深入浅出python闭包</a></li>
</ul>
<h2>本文源码下载：</h2>
<ul>
<li><a href="https://github.com/bosichong/17python.com/blob/master/deftest/closuretest.py">github</a></li>
<li><a href="https://gitee.com/J_Sky/17python.com/blob/master/deftest/closuretest.py">开源中国码云镜像gitee</a></li>
</ul></p>


<hr>
<br>


<hgroup>
    <h2>Python并发编程（下）功能强大设置简单的分布式多进程生产者与消费者模式</h2>
    <h3> 作者:<a href="#">J.sky</a> | <small>发表于:2017-10-07 14:09:46</small> | <small>更新于:2023-04-04 20:47:12</small> | Tag:
        
        
        <samll>Python基础</samll>
        
    </h3>
</hgroup>
<p><p><img alt="输入图片说明" src="https://suiyan.cc/assets/images/media/upload/2017/10/e.jpg" />
在<code>Python</code>的日常生活中，当你要进行一系列超大型密集的计算任务或是超多未知的数据需要采集时，一台机器或许已经无法满足你的需求了，这时就得考虑使用到分布式操作进行任务处理了。</p>
<h2>一个无聊而又变态的需求</h2>
<p>我们假设有一个无聊而又变态的任务：有一系列的任务会成生一组随机&gt;=0的整数队列[n,n,n,.....n,n]，我们需要立即取得他们的n*n自乘结果。当然你也可以使用单线程进行相关的操作，但是由于计算任务巨大，我们不得采用分布式多进程生产者与消费者模式来进行程序的执行了，好吧，我们先了解一下相关术语。</p>
<h2>分布式</h2>
<p>在一个分布式系统中，一组独立的计算机展现给用户的是一个统一的整体，就好像是一个系统似的。这种情景下就是分布式。</p>
<h2>为什么要用分布式多进程而不是多线程？</h2>
<p>由于<code>Python</code>解释器中使用了内部的GIL全局解释器锁，使得<code>Python</code>多线程的并发在任意时刻只允许单个CPU来运行，这样的运行方式会影响程序的并发。所以多线程并不适用于高密度的计算任务，由于计算任务数量庞大，所以采用分布式可以大大提高计算的速度。</p>
<h2>关于<code>Python</code>的进程</h2>
<p>请点击传送门:<a href="http://www.17python.com/blog/34">Python并发编程（上）进程模块multiprocessing模块和Process类</a></p>
<h2>Managers</h2>
<p>管理器提供一种创建可在不同进程之间共享的数据的方法，包括在不同机器上运行的进程之间通过网络共享。管理员对象控制管理共享对象的服务器进程。其他进程可以通过使用代理访问共享对象。这里我们使用<code>multiprocessing.managers.BaseManager</code>来创建一个多进程管理器，对网络的任务进行注册和管理。<code>BaseManager</code>下边封装了很多相关的方法，大大简化了网络上进程之间的通信，可以方便的组建分布式的进程任务。</p>
<h2>Queue</h2>
<p><code>Queue</code>实现多生产者，多消费者队列。它特别适用于信息必须在多个线程间安全地交换的多线程程序中。在本次分布式多进程的任务<code>Queue</code>起到了非常重要的作用。</p>
<h2>开始编码前</h2>
<p>我们先构思一下程序需要的模块：</p>
<ul>
<li>上帝（God也是服务器，服务器负责注册队列queue,并接收并查看到最终结果。） </li>
<li>生产者（Producer,负责生产出需要进行计算的数据并发送给消费者。）</li>
<li>消费者（Consumer，负责接收生产者发来的数据并进行计算，最后把结果发送给上帝看.）</li>
</ul>
<p>相关思维导图：如果下
<img alt="输入图片说明" src="https://suiyan.cc/assets/images/media/upload/2017/10/swdt.png" /></p>
<h2>程序构建要点：</h2>
<pre><code>class GodManager(BaseManager):
    pass
</code></pre>
<p>注册一个管理器，负责注册或获取网上的队列<code>Queue</code>。</p>
<p>服务器上需要创建程序中必需的queue,并注册到网上。</p>
<pre><code>GodManager(address=('192.168.0.88',5678),authkey=b'www.17python.com')
</code></pre>
<p>注册服务器，通过<code>start()</code>启动，通过<code>connect()</code>连接。通过<code>manager.pq()</code>类似的方法获取网上的队列。</p>
<p><em>注意，分布式多进程中一定要获取网上注册的<code>queue</code></em>，否则会造成数据错乱。</p>
<p>另外，测试时，请在终端中启动程序，网络连接错误的，建议查看一下防火墙是不是禁止了网络的连通，不要在IDE中使用调试来测试本程序。</p>
<h2>God源码</h2>
<pre><code class="python">import random, time, queue
from multiprocessing.managers import BaseManager
# 创建任务需要的两个队列
pq = queue.Queue()
cq = queue.Queue()
# 注册一个管理器，注册Queue队列到网，供其它终端使用。
class GodManager(BaseManager):
    pass

#把任务队列通过管理器注册到网上，这样就可以在多台机器间访问通信，做到分布式通信。
GodManager.register('pq',callable=lambda:pq)
GodManager.register('cq',callable=lambda:cq)
#设置服务器的ip、端口及密码
manager = GodManager(address=('192.168.0.88',5678),authkey=b'www.17python.com')
manager.start()#启动服务器
print('服务器已经启动！')
#重新获取已经在网上注册的队列,使用队列名()方法来获得网上注册的队列名。
p_q = manager.pq()
c_q = manager.cq()

while True:
    if c_q.empty():#如果结果集队列空
        time.sleep(1)
        print("静静的等待计算结果中。。。。。。")
    else:
        r = c_q.get()#获得传来的计算结果
        print("收到任务计算结果%s" % r)
</code></pre>

<h2>Producer 生产者</h2>
<pre><code class="python">import random, time
from multiprocessing.managers import BaseManager

# 注册一个管理器，负责管理调度网上注册的Queue队列
class ProducerMagager(BaseManager):
    pass
#获取网络上的Queue 生产者，只关心生产需要计算的数据即可。
ProducerMagager.register('pq')
# 注册生产者服务器，address 真写IP及端口，authkey是一个密码，如果需要访问此处必须与服务器一致。
pm = ProducerMagager(address=('192.168.0.88',5678), authkey=b'www.17python.com')
pm.connect()#连接服务器
print('生产者服务器已经准备就绪！')
task = pm.pq()#获取生产者的队列
k = 1
#
while True:
    for i in range(10):
        r = random.randint(0,999)
        task.put(r)
    print("第{0}轮任务完毕！稍后继续！".format(k))
    k += 1
    time.sleep(3)
</code></pre>

<h2>Consumer 消费者</h2>
<pre><code class="python">import time
from multiprocessing.managers import BaseManager

# 注册一个管理器，负责管理调度网上注册的Queue队列
class ConsumerMagager(BaseManager):
    pass

#获取网络上的Queue 消费者，需要获取任务，计算后发送任务。
ConsumerMagager.register('pq')
ConsumerMagager.register('cq')

m = ConsumerMagager(address=('192.168.0.88',5678),authkey=b'www.17python.com')
m.connect()#连接服务器
pq = m.pq()
cq = m.cq()
#开始计算任务
while True:
    if not pq.empty():#如果任务队列不为空
        n = pq.get(timeout=1)#如果超。
        print('收到计算任务{0}*{1}={2}'.format(n,n,n*n))
        cq.put('%d * %d = %d' %(n,n,n*n))
    else:
        time.sleep(1)
        print("好无聊，我在等待任务安排中")
</code></pre>

<p>在终端分别启动<code>python3 God.py</code> <code>python3 producer.py</code> <code>python3 Consumer.py</code></p>
<p><img alt="输入图片说明" src="https://suiyan.cc/assets/images/media/upload/2017/10/Snip20171007_3.png" />
<img alt="输入图片说明" src="https://suiyan.cc/assets/images/media/upload/2017/10/Snip20171007_4.png" />
<img alt="输入图片说明" src="https://suiyan.cc/assets/images/media/upload/2017/10/Snip20171007_5.png" /></p>
<p>然后就可以观察终端打印的结果，服务器终端显示着计算回来的结果，除了服务器以外，生产者和消费者都可以分布式在各个终端上启动多个进行任务的生成和计算。
我这里只在本机上进行测试了，如果只是在一台机器上进行多进程的计算，可以不必网上注册，使用唯一的<code>Queue</code>进行通信即可。</p>
<p>别小睢这个小小的分布式，稍加修改任务即可变成强大的分布式采集程序，看你怎么用了。</p>
<h2>参考文档</h2>
<ul>
<li><a href="http://python.usyiyi.cn/documents/python_352/library/queue.html#queue.Queue">queue - 同步队列类</a></li>
<li><a href="http://python.usyiyi.cn/documents/python_352/library/multiprocessing.html">multiprocessing —— 基于进程的并行</a></li>
</ul>
<h2>本文源码下载：</h2>
<ul>
<li><a href="https://github.com/bosichong/17python.com/tree/master/multiprocessingtest.py">github</a></li>
<li><a href="https://gitee.com/J_Sky/17python.com/tree/master/multiprocessingtest.py">开源中国码云镜像gitee</a></li>
</ul></p>


<hr>
<br>



<nav>
    <li><a href="list_18.html" role="button" class="outline">Prev</a></li>
    <li><small>19 / 28</small></li>
    <li><a href="list_20.html" role="button" class="outline">Next</a></li>
</nav>

</section>
        <aside><section>
    <hgroup>
        <h2>Search</h2>
        <h3>Search This SuiYan blog</h3>
    </hgroup>

    <!-- Search -->
    <input type="text" id="search-input" name="search" placeholder="JavaScript">
    <button id="search-btn" class="contrast"
            data-target="modal-example"
            onClick="toggleModal(event)">Search
    </button>


    <!-- Modal -->
    <dialog id="modal-example">
        <article>
            <a href="#close"
               aria-label="Close"
               class="close"
               data-target="modal-example"
               onClick="toggleModal(event)">
            </a>
            <h3>搜索结果</h3>
            <div id="modal" style="display: none;">
                <ul id="result-list"></ul>
            </div>
        </article>
    </dialog>
    <script src="https://suiyan.cc/assets/js/url.js"></script>
    <script src="https://suiyan.cc/assets/js/main.js"></script>
    <script src="https://suiyan.cc/assets/js/modal.js"></script>

</section>


<nav>
    <ul>
        
        <li>
            <a href="https://suiyan.cc/index.html">
                <i class="fa fa-home"></i>
                Blog Home
            </a>
        </li>
        
        <li>
            <a href="https://suiyan.cc/archives.html">
                <i class="fa fa-archive"></i>
                Blog Archive
            </a>
        </li>
        
        <li>
            <a href="https://suiyan.cc/tags.html">
                <i class="fa fa-tags"></i>
                Blog Tag
            </a>
        </li>
        
        <li>
            <a href="https://suiyan.cc/aboutme.html">
                <i class="fa fa-user"></i>
                About Me
            </a>
        </li>
        
    </ul>
</nav>
</aside>
    </div>

</main>
<footer><div class="container">
    <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
    <p><small>
        Powered by
    </small>
        <a href="https://github.com/Jsky2020/suiyan" target="_blank">
            SuiYan
        </a>
       <small> | </small><a href="https://github.com/bosichong" target="_blank">
            J.sky
        </a>
        <small>
            Copyright
            <i aria-hidden="true" class="fa fa-copyright">
            </i>
            2017-2023
        </small>
    </p>
</div></footer>
<!-- Minimal theme switcher -->
<script src="https://suiyan.cc/assets/js/minimal-theme-switcher.js"></script>
<!-- Scroll to Top button selector -->
<a class="to-top"><i class="fa fa-chevron-up fa-3" aria-hidden="true"></i></a>
<script src="https://suiyan.cc/assets/js/jquery.toTop.min.js"></script>
<script>
        jQuery(function($){
            // Plugin activation (basic - with all default values)
            // $('.to-top').toTop();

            // Plugin activation with options
            $('.to-top').toTop({
                //options with default values
                autohide: true,  //boolean 'true' or 'false'
                offset: 420,     //numeric value (as pixels) for scrolling length from top to hide automatically
                speed: 500,      //numeric value (as mili-seconds) for duration
                position:true,   //boolean 'true' or 'false'. Set this 'false' if you want to add custom position with your own css
                right: 15,       //numeric value (as pixels) for position from right. It will work only if the 'position' is set 'true'
                bottom: 30       //numeric value (as pixels) for position from bottom. It will work only if the 'position' is set 'true'
            });
        });

</script>
</body>
</html>